# npm, pnpm

이전 회사에서 npm을 pnpm으로 변경하는 티켓을 백로그로 발행한 적이 있었다. 해당 작업은 결국 이행되지 못했지만 현 개인 페이지에 해당 작업을 진행하면서 작업에 유의미한 차이를 낼 수 있는지 체크해보려한다.

### 패키지 매니저(Package Manager)

패키지매니저는 **패키지**(코드 배포를 위한 코드 묶음)를 설치, 수정등의 작업을 관리하고 보조하는 프로그램이다. 대부분의 언어는 이러한 패키지매니저를 제공하고(ex> Python - pip) 사용자는 이러한 매니저를 통해 개발 환경을 구축한다.

대체로 패키지매니저는 아래 동작을 수행한다.

> - 패키지간 의존성 추가, 설치, 관리, 업데이트
> - 스크립트 실행
> - 패키지 배포
> - 패키지 보안 및 신뢰 관리

javascript의 패키지 매니저들은 의존성 관리를 위한 버전 정의를 먼저 동작한다. 설치하고자 하는 패키지의 버전을 package.json에 선언하고 해당 패키지가 요구하는 외부 의존성을 정의한다. 실제로 작업 중 볼 수 있는 package-lock.json이나 yarn.lock이 이에 해당한다.(**Resolution**)

패키지 매니저는 이 정의을 기반으로 필요 패키지를 일괄적으로 다운로드한다.(**Fetch**)

마지막으로 해당 패키지들을 사용할 수 있도록 node_modules에 배치한다.(**Link**)

### pnpm

Link의 과정에서 npm은 각각의 패키지가 요구하는 모든 node_module을 일괄적으로 작성한다. 따라서 요구되는 용량이 크고 모든 dependency를 타고 들어가야 최종적인 패키지에 접근하므로 속도가 느리다.
반면 pnpm은 이러한 의존 node_module을 별도의 디렉토리에 모아서 처리한다. 결론적으로 디펜던시에 중복이 많을 수 록 용량을 크게 줄일 수 있다는 점이다.
pnpm은 각 의존 패키지로의 경로를 hard link로 등록해 처리한다.

### 비교

npm / pnpm은 다양한 차이를 보이지만 현재 프로젝트에서 직접 확인할 만한 요소는 패키지 빌드 타임이다.

로컬(os ubuntu-20.4) 기준 작업값은 아래와 같다.

|매니저|환경|시간|
|---|---|---|
|npm|zero base|95 sec|
|yarn|zero base|46 sec|
|pnpm|zero base|16 sec|
|npm|package-lock.json|11 sec|
|yarn|yarn.lock|14 sec|
|pnpm|pnpm-lock.yarml|5 sec|

단순 비교값으로는 `pnpm`이 가장 좋은 빌드 타임을 보여준다. 아쉽게도 빌드 캐시 이용시 큰 시간 차이가 나지 않아 배포레벨에서 빌드 타임의 차이를 보여주진 않는다.
(기존 yarn 사용)

현재 프로젝트 규모로는 명확한 성능상 향상을 확인하긴 어렵지만 최초 빌드시의 타임 감소에 의의를 둔다.
